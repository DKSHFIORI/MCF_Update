sap.ui.define(["sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/ui/core/Core","sap/m/BusyDialog"],(function(e,t,a,n,s){"use strict";return{onInit:function(){this._oBusyDialog=new s,this._MessageManager=n.getMessageManager()},onSelectedChangeType:function(e){let t=e.getParameter("value"),a=this.byId("dksh.ymm.mcfupdate.mcfupdate::sap.suite.ui.generic.template.ObjectPage.view.Details::YMM_C_MCF_UPDATE--idChangePanel::Section"),n=this.byId("dksh.ymm.mcfupdate.mcfupdate::sap.suite.ui.generic.template.ObjectPage.view.Details::YMM_C_MCF_UPDATE--idCCDChangePanel::Section");"Finance Related"==t?(a.setVisible(!0),n.setVisible(!1)):(a.setVisible(!1),n.setVisible(!0))},onSelectedCountryType:function(e){},beforeSaveExtension:function(){},onExit:function(){},onAfterRendering:function(){var e=this;let t=this.byId("dksh.ymm.mcfupdate.mcfupdate::sap.suite.ui.generic.template.ObjectPage.view.Details::YMM_C_MCF_UPDATE--idMaterialInput::Country::Field");sap.ui.getCore().byId("dksh.ymm.mcfupdate.mcfupdate::sap.suite.ui.generic.template.ObjectPage.view.Details::YMM_C_MCF_UPDATE--idMaterialInput::ChangeType::Field").attachChange(e.onSelectedChangeType,e),t.attachChange(e.onSelectedCountryType,e),this.byId("dksh.ymm.mcfupdate.mcfupdate::sap.suite.ui.generic.template.ObjectPage.view.Details::YMM_C_MCF_UPDATE--idChangePanel::Section").setVisible(!1),this.byId("dksh.ymm.mcfupdate.mcfupdate::sap.suite.ui.generic.template.ObjectPage.view.Details::YMM_C_MCF_UPDATE--idCCDChangePanel::Section").setVisible(!1)},handleUploadPress:function(e){let t=this.byId("idFileUploader");if(!t.getValue())return void sap.m.MessageBox.error("Please select a file to upload.");this.csrfToken=this.getView().getModel().getSecurityToken(),t.setSendXHR(!0);let a=new sap.ui.unified.FileUploaderParameter;a.setName("x-csrf-token"),a.setValue(this.csrfToken);let n=new sap.ui.unified.FileUploaderParameter;n.setName("slug"),n.setValue(t.getValue()),this._oBusyDialog.setText("Uploading..."),this._oBusyDialog.open(),t.checkFileReadable().then((function(){t.addHeaderParameter(a),t.addHeaderParameter(n),t.addHeaderParameter(oHeaderParamContent),t.upload(),t.destroyHeaderParameters()}),(function(e){MessageBox.error("The file cannot be read. It may have changed."),this._oBusyDialog.close()})).then((function(e){t.clear()}))},extractErrorMessage:function(e){return(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("errordetail")},handleUploadComplete:function(e){let t=e.mParameters.responseRaw,a=this.extractErrorMessage(t);if(a.length>0)for(var n=0;n<a.length;n++){let e,t=a[n].getElementsByTagName("message"),s=a[n].getElementsByTagName("severity");if("Exception raised without specific error"!==t[0].textContent)switch(s[0].textContent){case"error":e=MessageType.Error;break;case"success":e=MessageType.Warning;break;case"info":e=MessageType.Information;break;default:e=MessageType.None}}else MessageBox.success("Successfully Uploaded");this.getOwnerComponent().getModel().refresh(!0),this._oBusyDialog.close()},handleCancelPress:function(e){},onSaveDraft:function(){console.log("Save as draft!")},_setFileUploader:function(e){const a=this,n="idattachmentComponentContainer",s="MCFU-TH100000852";let i=new t(s);a.setModel("sKey",i);if(null===this.byId(n).getComponent()){const t=s;this.getOwnerComponent().createComponent({usage:"attachmentReuseComponent",settings:{mode:"I",objectKey:t,objectType:e,onupload:[a.handleUpload,a],ondelete:[a.handleDelete,a]}}).then(function(e){const t=e.getAttributes(),s=this._prepareAttrList(t);e.setAttributes(s),a.byId(n).setComponent(e),e.page.getController().getUploadCollectionControl().attachBeforeUploadStarts((function(e){a.fileUploadBusyCounter++}))}.bind(this))}},_makeBackendCall:function(e,t){const a=this.getView().getModel(),n={d:t.getObject()};delete n.d.__metadata;const s=this._getTempKeyFromModel();a.setHeaders({"temp-obj-key":s}),a.create(e,n,{})},handleUpload:function(e){const{status:t,fileName:a}=e.getParameters();"UPLOADSUCCESS"===t&&(this._addAttachmentToString(a,"/attachmentString"),this.fileUploadBusyCounter--)},handleDelete:function(e){const{status:t,fileName:a}=e.getParameters();"DELETED"===t&&this._removeAttachmentFromString(a,"/attachmentString")},_prepareAttrList:function(e){const t=["UPLOADEDBY","UPLOADEDON","FILESIZE","ENABLELINK","ATTACHMENTSTATUS","ATTACHMENTTITLE","DIRDETAILS","SOURCE"],a=["DELETE","ADD"];return Object.keys(e._VisibleAttributes).forEach((a=>{e._VisibleAttributes[a]=t.includes(a)})),Object.keys(e._VisibleActions).forEach((t=>{e._VisibleActions[t]=a.includes(t)})),e},_deleteUploadedAttachments:function(){const e=this.byId("attachmentComponentContainer").getComponentInstance();e&&e.cancel(!1)}}}));